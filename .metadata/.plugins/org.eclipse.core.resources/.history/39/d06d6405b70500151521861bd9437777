#include <msp430.h> 
#include "./TI_MSP_UART.h"
#include <stdio.h>
#include <string.h>

#define MSP430_UART_SMCLK_FREQ SMCLK_1MHZ
#define MSP430_UART_BAUD_RATE  BAUD_RATE_9600BPS

char buffer[7];
char debug[20];
char datoLeido;
int cantidadDatosLeidos;
int n1, n2;
char operacion;

void push(char a);
void debugger(char *debug);
void parser();

void main(void) {
    WDTCTL = WDTPW | WDTHOLD;	// Stop watchdog timer

    /* configure internal digitally control led oscillator */
    BCSCTL1 = CALBC1_1MHZ;
    DCOCTL  = CALDCO_1MHZ;
	
    Init_UART();

	__enable_interrupt();

	while(1){
		//UART_Tx_string(buffer, 0);
	}
}

#pragma vector=UART_ISR_RX_VECTOR
__interrupt void ISR_UartRx(void){
    if(UART_IFG & UART_UCAxRXIFG){
      datoLeido = UART_UCAxRXBUF;
	  push(datoLeido);
    }
}

void push(char a){
	UART_Tx_char(a);
	if(a == 13){
		parser();
	}else{
		buffer[cantidadDatosLeidos] = a;
		cantidadDatosLeidos++;
	}
}

void parser(){
	n1 = buffer[0]*100 + buffer[1]*10 + buffer[2];
	operacion = buffer[4];
	n2 = buffer[5]*100 + buffer[6]*10 + buffer[7];
	sprintf(debug, "%d\n", n1);
	sprintf(debug, "%c\n", operacion);
	sprintf(debug, "%d\n", n2);
}

void debugger(char *debug){
	UART_Tx_string(debug, 0);
}
